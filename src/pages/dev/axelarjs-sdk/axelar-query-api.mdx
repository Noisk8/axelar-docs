# Axelar query API
Este módulo es bueno para tener con el cuañ se pueden hacer consultas comunes en la red Axelar y sus servicios, que se abstraen en una forma facil de usar de tan solo una linea de JavaScript 

### Instalar el Módulo del SDK AxelarJS (`AxelarQueryAPI`)

Instalar el SDK AxelarJS:

```bash
npm i @axelar-network/axelarjs-sdk
```

Instancial el módulo `AxelarQueryAPI`:

```ts
const sdk = new AxelarQueryAPI({
  environment: "testnet",
});
```

### Posibles consultas

#### `estimateGasFee`

Se trata de una consulta útil para las transacciones GMP, cuando se invoca `callContract` o `callContractWithToken` para obtener una estimación del pago de gas apropiado que debe realizarse al receptor de gas en la cadena de origen.

NOTAS IMPORTANTES:

* Debe asegurarse de que se utiliza el `gasLimit` correcto para su estimación de gas. El límite de gas es igual al coste de gas de ejecución en la cadena de destino. Puede probar las llamadas GMP para encontrar el valor correcto.
* Los parámetros `minGasPrice` y `gasMultipler` pueden ajustarse para mejorar la seguridad de ejecución de las transacciones entre cadenas.
* Cadenas L2. Para la ejecución de llamadas GMP en las que la cadena de destino es una cadena EVM L2, es importante tener en cuenta que todas las cadenas L2 tienen un coste adicional de contabilización de la transacción ejecutada de vuelta a la cadena L1. Este método SDK `estimateGasFee` agregará ese coste estimado para usted. Los parámetros a llamar específicamente para L2s son:
  - el parámetro `gasLimit`, que son las unidades de gas reales necesarias para ejecutar el tx en la cadena L2. Puedes comprobarlo empíricamente mirando el gas utilizado para ejecutar el `AxelarExecutable` en la cadena de destino.
  - el parámetro `executeData`, que son los datos GMP que se ejecutarán en la cadena de destino L2. Esto es importante para las cadenas OP-stack, donde el SDK consulta un contrato de oráculo de gas con este executeData para recuperar el fee L1, y si no se proporciona el parámetro para `executeData`, se utiliza una pieza stub de `executeData`.
*  La respuesta al método proporciona un único valor (en `wei`) del gas total estimado necesario para la llamada a través de la cadena. En el parámetro GMPParams, existe la opción de mostrar un desglose completo de los fees especificando `true` para `showDetailedFees`. Si hace esto, tendrá que añadir los componentes individuales de los fees usted mismo, por ejemplo.
  - `(baseFee + executionFeeWithMultiplier)` para llamadas GMP de forma regular,
  - `(baseFee + executionFeeWithMultiplier + l1ExecutionFeeWithMultiplier)` para llamadas GMP de forma regular a cualquier cadena L2 ,
  - `(baseFee + executionFeeWithMultiplier + expressFee)` para llamadas GMP Express

```ts

  interface GMPParams {
    showDetailedFees: boolean;
    transferAmount?: number; // En términos de símbolo, no de denominación de la unidad, por ejemplo, utilice 1 para 1 axlUSDC, no 1000000
    transferAmountInUnits?: string; // En términos de denominación de la unidad, no de símbolo, por ejemplo, utilice 1000000 para 1 axlUSDC, no 1
    destinationContractAddress: string;
    sourceContractAddress: string;
    tokenSymbol: string;
  }
  export interface AxelarQueryAPIFeeResponse {
    expressFee: string;
    baseFee: string;
    executionFee: string;
    executionFeeWithMultiplier: string;
    l1ExecutionFeeWithMultiplier: string;
    l1ExecutionFee: string;
    gasMultiplier: number;
    gasLimit: BigNumberish;
    minGasPrice: string;
    apiResponse: any;
    isExpressSupported: boolean;
  }

  /**
   * Calcular el importe estimado de gas a pagar por el contrato de receptor de gas.
   * @param sourceChainId Puede ser del tipo EvmChain enum o string. Si es una cadena, debe intentar generalizarse para utilizar las constantes CHAINS (por ejemplo, CHAINS.MAINNET.ETHEREUM). 
   * @param destinationChainId Puede ser del tipo EvmChain enum o string. Si es una cadena, debe intentar generalizarse para utilizar las constantes CHAINS (por ejemplo, CHAINS.MAINNET.ETHEREUM).
   * @param gasLimit  Cantidad estimada de gas necesaria para ejecutar la función `execute` o `executeWithToken`.
   * @param gasMultiplier (Opcional) Multiplicador utilizado para crear un buffer por encima del fee de gas calculado, para tener en cuenta posibles desviaciones a lo largo de la ejecución de la tx, por ejemplo 1,1 = 10% de buffer. admite hasta 3 decimales.
   * El valor por defecto es «auto», que utiliza el multiplicador de gas de la respuesta de fee
   * @param sourceChainTokenSymbol (Opcional) el símbolo del token de gas en la cadena de origen.
   * @param minGasPrice (Opcional) Un valor mínimo, en wei, para el precio del gas en la cadena de destino que se utiliza para anular el precio estimado del gas si cae por debajo de este valor especificado.
   * @param executeData (Opcional) Los datos que se ejecutarán en la cadena de destino. Se recomienda especificarlo si la cadena de destino es una cadena L2 para calcular con mayor precisión el gas fee.
   * @param gmpParams (Opcional) Parámetros adicionales para las transacciones GMP, incluida la posibilidad de ver una vista detallada de la respuesta de fee.
   * @returns
   */
  public async estimateGasFee(
    sourceChainId: EvmChain | string,
    destinationChainId: EvmChain | string,
    gasLimit: BigNumberish,
    gasMultiplier: number | "auto" = "auto",
    sourceChainTokenSymbol?: GasToken | string,
    minGasPrice = "0",
    executeData?: `0x${string}`,
    gmpParams?: GMPParams
  ): Promise<string | AxelarQueryAPIFeeResponse>
```

#### getTransferFee

Dada una cadena de origen, una cadena de destino y el importe de un activo, esta consulta recupera el fee base que la red aplicaría a esa transacción.

```ts
/**
 * Obten el fee de transferencia de una transacción determinada
 * @param sourceChainName
 * @param destinationChainName
 * @param assetDenom
 * @param amountInDenom
 * @returns
 */
public async getTransferFee(
  sourceChainName: string,
  destinationChainName: string,
  assetDenom: string,
  amountInDenom: number
): Promise<TransferFeeResponse>
```

#### getFeeForChainAndAsset

Dada una cadena y un bien, recupera el fee base que la red aplicaría.

```ts
/**
 * Obten el fee de una cadena y un activo
 * @param chainName
 * @param assetDenom
 * @returns
 */
public async getFeeForChainAndAsset(
  chainName: string,
  assetDenom: string
): Promise<FeeInfoResponse>
```

#### getDenomFromSymbol

Obten el denom de un activo dado su símbolo en una cadena. Para todos los activos que Axelar soporta de forma nativa, la red identifica el activo por un `denom`, mientras que la mayoría de las cadenas EVM tienen un `símbolo` para el activo.

El siguiente método permite traducir el símbolo del activo (tal y como se identifica en una cadena EVM) al denom subyacente.

```ts
/**
 * @param symbol
 * @param chainName
 * @returns
 */
public async getDenomFromSymbol(symbol: string, chainName: string)
```
Por ejemplo, supongamos que tiene el testnet canónico de Axelar `aUSDC`. El símbolo de este activo en las cadenas EVM es `aUSDC`, y el denom es `uausdc`. Ejemplo de uso para obtener el denom a partir del símbolo:

```ts
  const queryConfig: AxelarQueryAPIConfig = {
    environment: Environment.TESTNET
  }
  const api = new AxelarQueryAPI(queryConfig);

  async function main() {
    const denom = await api.getDenomFromSymbol("aUSDC", "moonbeam");
    console.log("denom: ",denom);
    return denom;
  }

  //expected returned result: uausdc
```


#### getSymbolFromDenom

Obtiene el símbolo de un activo en una cadena dada dado su denom. Para todos los activos que Axelar soporta de forma nativa, la red identifica el activo por un `denom`, mientras que la mayoría de las cadenas EVM tienen un `símbolo` para el activo.

El siguiente método le permite traducir el nombre del activo al símbolo del activo (tal y como se identifica en una cadena EVM).

```ts
/**
 * @param denom
 * @param chainName
 * @returns
 */
public async getSymbolFromDenom(denom: string, chainName: string)
```
Por ejemplo, supongamos que tiene el testnet canónico de Axelar `aUSDC`. El símbolo de este activo en las cadenas EVM es `aUSDC`, y el denom es `uausdc`. Ejemplo de uso para obtener el símbolo de denom:

```ts
  const queryConfig: AxelarQueryAPIConfig = {
    environment: Environment.TESTNET
  }
  const api = new AxelarQueryAPI(queryConfig);

  async function main() {
    const symbol = await api.getSymbolFromDenom("uausdc", "moonbeam");
    console.log("symbol: ",symbol);
    return symbol;
  }

  //expected returned result: aUSDC
```
